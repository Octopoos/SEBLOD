/* Copyright (C) 2009 - 2018 SEBLOD. All Rights Reserved. */
void 0===JCck.More&&(JCck.More={}),function(u){function g(t){var t=t.attr("id"),e=t?(e=t.lastIndexOf("_"),parseInt(t.slice(e+1))):"";return e}function m(t){var e=t.parent(),t=g(t),e=0==t?"first":t==e.children().length-1?"last":"middle";return e}function k(t){t.addClass("cck_form_group_x_last"),t.find(".cck_cgx_button").addClass("cck_cgx_button_last"),t.find(".cck_cgx_form").addClass("cck_cgx_form_last")}function x(t){t.removeClass("cck_form_group_x_last").find(".cck_cgx_button_last,.cck_cgx_form_last").removeClass("cck_cgx_button_last cck_cgx_form_last")}function a(t,e,c){var r=RegExp(c+"_0","g");return t=t.replace(r,c+"_"+e),r=RegExp(c+"[[]0","g"),t=t.replace(r,c+"["+e)}function _(t,e,c,r){i=g(t)+"";var n,i=parseInt(i);switch(e){case"add":n=i+1;break;case"del":n=i-1}t.attr("id",r+"_forms_"+c+"_"+n),t.find(".cck_cgx_button").attr("id",r+"_button_"+c+"_"+n);var a,e=t.find(".cck_cgx_form");1<e.length?e.each(function(t){u(this).attr("id",r+"_form_"+c+"_"+n+"_"+t)}):e.attr("id",r+"_form_"+c+"_"+n),e.find('[name^="'+c+"["+i+']"]').each(function(t){a=u(this).attr("name").replace(c+"["+i,c+"["+n),u(this).attr("name",a)}),e.find('[id^="'+c+"_"+i+'_"]').each(function(t){a=u(this).attr("id").replace(c+"_"+i,c+"_"+n),u(this).attr("id",a)}),e.find('[id^="'+r+"_"+c+"_"+i+'_"]').each(function(t){a=u(this).attr("id").replace(r+"_"+c+"_"+i,r+"_"+c+"_"+n),u(this).attr("id",a)}),t.find("script").each(function(t){var e=new RegExp(c+"_"+i,"g");u(this).text(u(this).text().replace(e,c+"_"+n))})}function p(t,e,c,r){for(var n=t.parent().children(":last"),i=t,a=!1;!a;)i.attr("id")==n.attr("id")?(_(i,e,c,r),a=!0):(_(i,e,c,r),i=i.next())}JCck.More.GroupX={add:function(e,c,r,n){var a,_,l,s,o,d=u("#"+n+"_sortable_"+e),f=d.children().length,h={color:"#d5eeff"};u("body").on("click",".cck_button_add_"+e,function(){if(elem=u(this).hasClass("external")?d.children("div").last():u(this).closest('[id^="'+n+"_forms_"+e+'"]'),s=0==d.children().length?(o=d,"inside"):(o=elem,"after"),(_=elem.parent().children().length)<c)switch(l=m(elem),a=g(elem)+1,l){case"first":x(d.children("div:first")),JCck.More.GroupX.insert(o,r,a,e,s),u("#"+n+"_button_"+e+"_"+a).show("highlight",h,1e3),1==_?(x(elem),k(elem.next())):p(elem.next().next(),"add",e,n);break;case"last":x(d.children("div:last")),JCck.More.GroupX.insert(o,r,a,e,s),k(elem.next()),u("#"+n+"_button_"+e+"_"+f).show("highlight",h,1e3);break;case"middle":JCck.More.GroupX.insert(o,r,a,e,s),u("#"+n+"_button_"+e+"_"+a).show("highlight",h,1e3),p(elem.next().next(),"add",e,n)}var t=document.querySelectorAll(".field-calendar");if(0<t.length)for(i=0;i<t.length;i++)JoomlaCalendar.init(t[i])})},insert:function(t,e,c,r,n){"after"==n?t.after(a(e,c,r)):t.append(a(e,c,r))},remove:function(c,r,n){var i,a,_;u("body").on("click",".cck_button_del_"+c,function(){var t,e=(i=u(this).closest('[id^="'+n+"_forms_"+c+'"]')).parent().children().length;if(r<e)switch(a=m(i),ind_elem=g(u(this).parent().parent()),"last"!=a&&p(i.next(),"del",c,n),i.toggle(),i.remove(),a){case"first":_=u("#"+n+"_sortable_"+c).children(":first"),(t=_).addClass("cck_form_group_x_first"),t.find(".cck_cgx_button").addClass("cck_cgx_button_first"),t.find(".cck_cgx_form").addClass("cck_cgx_form_first");break;case"last":k(_=u("#"+n+"_sortable_"+c).children(":last"))}u.isFunction(JCck.Core.recalc)&&JCck.Core.recalc()})}}}(jQuery);