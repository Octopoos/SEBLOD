/* Copyright (C) 2009 - 2018 SEBLOD. All Rights Reserved. */
if("undefined"===typeof JCck.More){JCck.More={}};
!function(t){function e(t){var e,c,r=t.attr("id");return r?(e=r.lastIndexOf("_"),c=parseInt(r.slice(e+1))):c="",c}function c(t){var c=t.parent(),r=e(t);return 0==r?"first":r==c.children().length-1?"last":"middle"}function r(t){t.addClass("cck_form_group_x_last"),t.find(".cck_cgx_button").addClass("cck_cgx_button_last"),t.find(".cck_cgx_form").addClass("cck_cgx_form_last")}function n(t){t.removeClass("cck_form_group_x_last").find(".cck_cgx_button_last,.cck_cgx_form_last").removeClass("cck_cgx_button_last cck_cgx_form_last")}function i(c,r,n,i){var a,_=e(c)+"";switch(_.length,_=parseInt(_),r){case"add":a=_+1;break;case"del":a=_-1}c.attr("id",i+"_forms_"+n+"_"+a),c.find(".cck_cgx_button").attr("id",i+"_button_"+n+"_"+a);var s,l=c.find(".cck_cgx_form");1<l.length?l.each(function(e){t(this).attr("id",i+"_form_"+n+"_"+a+"_"+e)}):l.attr("id",i+"_form_"+n+"_"+a),l.find('[name^="'+n+"["+_+']"]').each(function(e){s=t(this).attr("name").replace(n+"["+_,n+"["+a),t(this).attr("name",s)}),l.find('[id^="'+n+"_"+_+'_"]').each(function(e){s=t(this).attr("id").replace(n+"_"+_,n+"_"+a),t(this).attr("id",s)}),l.find('[id^="'+i+"_"+n+"_"+_+'_"]').each(function(e){s=t(this).attr("id").replace(i+"_"+n+"_"+_,i+"_"+n+"_"+a),t(this).attr("id",s)}),c.find("script").each(function(e){var c=new RegExp(n+"_"+_,"g");t(this).text(t(this).text().replace(c,n+"_"+a))})}function a(t,e,c,r){for(var n=t.parent().children(":last"),a=t,_=!1;!_;)a.attr("id")==n.attr("id")?(i(a,e,c,r),_=!0):(i(a,e,c,r),a=a.next())}JCck.More.GroupX={add:function(i,_,s,l){var d,o,f,h,u,g=t("#"+l+"_sortable_"+i),m=g.children().length,k={color:"#d5eeff"};t("body").on("click",".cck_button_add_"+i,function(){if(t(this).hasClass("external")?elem=g.children("div").last():elem=t(this).closest('[id^="'+l+"_forms_"+i+'"]'),0==g.children().length?(u=g,h="inside"):(u=elem,h="after"),(o=elem.parent().children().length)<_)switch(f=c(elem),d=e(elem)+1,f){case"first":n(g.children("div:first")),JCck.More.GroupX.insert(u,s,d,i,h),t("#"+l+"_button_"+i+"_"+d).show("highlight",k,1e3),1==o?(n(elem),r(elem.next())):a(elem.next().next(),"add",i,l);break;case"last":n(g.children("div:last")),JCck.More.GroupX.insert(u,s,d,i,h),r(elem.next()),t("#"+l+"_button_"+i+"_"+m).show("highlight",k,1e3);break;case"middle":JCck.More.GroupX.insert(u,s,d,i,h),t("#"+l+"_button_"+i+"_"+d).show("highlight",k,1e3),a(elem.next().next(),"add",i,l)}})},insert:function(t,e,c,r,n){var i=jQuery(function(t,e,c){var r=RegExp(c+"_0","g");return t=t.replace(r,c+"_"+e),r=RegExp(c+"[[]0","g"),t.replace(r,c+"["+e)}(e,c,r));i.find(".cck_jform_media").length&&i.find(".field-media-wrapper").first().fieldMedia(),"after"==n?t.after(i):t.append(i)},remove:function(n,i,_){var s,l;t("body").on("click",".cck_button_del_"+n,function(){var d,o=(s=t(this).closest('[id^="'+_+"_forms_"+n+'"]')).parent().children().length;if(i<o)switch(l=c(s),ind_elem=e(t(this).parent().parent()),"last"!=l&&a(s.next(),"del",n,_),s.toggle(),s.remove(),l){case"first":(d=t("#"+_+"_sortable_"+n).children(":first")).addClass("cck_form_group_x_first"),d.find(".cck_cgx_button").addClass("cck_cgx_button_first"),d.find(".cck_cgx_form").addClass("cck_cgx_form_first");break;case"last":r(t("#"+_+"_sortable_"+n).children(":last"))}t.isFunction(JCck.Core.recalc)&&JCck.Core.recalc()})}}}(jQuery);